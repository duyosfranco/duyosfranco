<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TU BASURA MI TESORO - Reservas y Citas</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="hero" role="banner">
    <div class="hero__overlay"></div>
    <div class="hero__content">
      <div class="hero__branding">
        <img src="truck-icon.svg" alt="Cami√≥n reciclador" class="hero__icon" width="96" height="96">
        <div class="hero__heading">
          <h1 class="hero__title">TU BASURA, MI TESORO</h1>
          <p class="hero__subtitle">Recicladora habilitada I.M.M. N¬∫ 354 ‚Ä¢ Servicio en Montevideo, Uruguay</p>
        </div>
      </div>
      <a class="hero__cta" href="#reserva">Agendar retiro o solicitar informaci√≥n</a>
    </div>
  </header>

  <main>
    <section class="section" aria-labelledby="servicios-title">
      <div class="section__inner">
        <h2 id="servicios-title">Servicios disponibles</h2>
        <p>Trabajamos con agenda previa para atender necesidades puntuales o contratos de retiro planificado. Seleccion√° la opci√≥n que mejor se adapte a tu empresa u hogar:</p>
        <div class="cards" role="list">
          <article class="card" role="listitem">
            <h3>Contrato mensual</h3>
            <p>Program√° retiros frecuentes para residuos reciclables y especiales. Ideal para locales comerciales y oficinas.</p>
          </article>
          <article class="card" role="listitem">
            <h3>Contrato anual</h3>
            <p>Coordin√° un plan integral de gesti√≥n de residuos con tarifas preferenciales y seguimiento permanente.</p>
          </article>
          <article class="card" role="listitem">
            <h3>Retiro puntual</h3>
            <p>Soluci√≥n r√°pida para limpiezas, eventos o acumulaciones inesperadas. ¬°Coordinamos tu retiro en la fecha que necesites!</p>
          </article>
          <article class="card" role="listitem">
            <h3>Informaci√≥n general</h3>
            <p>Asesoramiento sobre clasificaci√≥n, disposici√≥n y reciclaje. Estamos para ayudarte a gestionar tus residuos.</p>
          </article>
        </div>
      </div>
    </section>

    <section class="section section--highlight" id="reserva" aria-labelledby="form-title">
      <div class="section__inner">
        <div class="section__text">
          <h2 id="form-title">Reserv√° tu retiro o ped√≠ informaci√≥n</h2>
          <p>Complet√° el formulario y nos pondremos en contacto para coordinar tu servicio. Tambi√©n pod√©s escribirnos por WhatsApp al <strong>095 079 009</strong>.</p>
          <ul class="contact-list">
            <li><span aria-hidden="true">üìç</span> Servicio disponible en Montevideo, Uruguay</li>
            <li><span aria-hidden="true">üïí</span> Agenda previa de lunes a s√°bado</li>
            <li><span aria-hidden="true">‚ôªÔ∏è</span> Gesti√≥n responsable de residuos</li>
          </ul>
        </div>
        <form class="form" id="reserva-form" aria-describedby="form-instructions">
          <p id="form-instructions">Los campos marcados con * son obligatorios.</p>
          <div class="form__field">
            <label for="nombre">Nombre completo *</label>
            <input type="text" id="nombre" name="nombre" required autocomplete="name">
          </div>
          <div class="form__field">
            <label for="email">Correo electr√≥nico *</label>
            <input type="email" id="email" name="email" required autocomplete="email">
          </div>
          <div class="form__field">
            <label for="telefono">Tel√©fono de contacto *</label>
            <input type="tel" id="telefono" name="telefono" required autocomplete="tel">
          </div>
          <div class="form__field">
            <label for="direccion">Direcci√≥n del local o residencia *</label>
            <input type="text" id="direccion" name="direccion" required autocomplete="street-address">
          </div>
          <div class="form__field">
            <label for="servicio">Tipo de servicio *</label>
            <select id="servicio" name="servicio" required>
              <option value="" disabled selected>Seleccion√° una opci√≥n</option>
              <option value="mensual">Contrato mensual</option>
              <option value="anual">Contrato anual</option>
              <option value="puntual">Retiro puntual</option>
              <option value="info">Informaci√≥n general</option>
            </select>
          </div>
          <div class="form__field">
            <label for="comentarios">Comentarios (tipo de residuo, horarios, etc.)</label>
            <textarea id="comentarios" name="comentarios" rows="4"></textarea>
          </div>
          <button type="submit" class="button">Enviar solicitud</button>
          <p class="form__feedback" id="form-feedback" role="status" aria-live="polite"></p>
        </form>
      </div>
    </section>

    <section class="section" aria-labelledby="accesibilidad-title">
      <div class="section__inner section__inner--narrow">
        <h2 id="accesibilidad-title">Compromiso con la accesibilidad</h2>
        <p>Nuestro sitio est√° dise√±ado para ser sencillo y usable por todas las personas. Si necesit√°s asistencia adicional o prefer√≠s agendar por otro medio, comunicate al <strong>095 079 009</strong> y te ayudaremos.</p>
      </div>
    </section>
  </main>

  <section class="section section--admin" id="admin" aria-labelledby="admin-title">
    <div class="section__inner section__inner--narrow">
      <div class="admin-header">
        <h2 id="admin-title">Panel de administraci√≥n</h2>
        <button type="button" class="button button--secondary" id="admin-toggle" aria-controls="admin-panel" aria-expanded="false">Acceso administrador</button>
      </div>
      <div id="admin-panel" class="admin-panel" hidden>
        <form id="admin-login" class="admin-login" aria-describedby="admin-help">
          <p id="admin-help">Ingres√° la contrase√±a de administrador para revisar o descargar el registro de solicitudes.</p>
          <div class="form__field">
            <label for="admin-password">Contrase√±a de administrador</label>
            <input type="password" id="admin-password" name="admin-password" required autocomplete="current-password">
          </div>
          <button type="submit" class="button">Ingresar</button>
          <p class="form__feedback" id="admin-feedback" role="status" aria-live="polite"></p>
        </form>
        <div id="admin-content" class="admin-content" hidden>
          <div class="admin-actions">
            <button type="button" class="button" id="admin-export">Descargar Excel</button>
            <button type="button" class="button button--secondary" id="admin-logout">Cerrar sesi√≥n</button>
          </div>
          <div class="table-container" role="region" aria-live="polite" aria-labelledby="admin-title">
            <table class="admin-table">
              <thead>
                <tr>
                  <th scope="col">Nombre</th>
                  <th scope="col">Correo</th>
                  <th scope="col">Tel√©fono</th>
                  <th scope="col">Direcci√≥n</th>
                  <th scope="col">Servicio</th>
                  <th scope="col">Comentarios</th>
                  <th scope="col">Fecha</th>
                </tr>
              </thead>
              <tbody id="registros-body">
                <tr class="admin-empty" hidden>
                  <td colspan="7">A√∫n no hay solicitudes registradas.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer" role="contentinfo">
    <div class="footer__inner">
      <p>¬© <span id="year"></span> TU BASURA, MI TESORO. Todos los derechos reservados.</p>
      <p>Recicladora habilitada I.M.M. N¬∫ 354</p>
    </div>
  </footer>

  <script>
    const STORAGE_KEY = 'tubasura-registros';
    const ADMIN_PASSWORD = 'TESORO2024';

    const yearElement = document.getElementById('year');
    const form = document.getElementById('reserva-form');
    const feedback = document.getElementById('form-feedback');
    const adminToggle = document.getElementById('admin-toggle');
    const adminPanel = document.getElementById('admin-panel');
    const adminLogin = document.getElementById('admin-login');
    const adminPassword = document.getElementById('admin-password');
    const adminFeedback = document.getElementById('admin-feedback');
    const adminContent = document.getElementById('admin-content');
    const adminExport = document.getElementById('admin-export');
    const adminLogout = document.getElementById('admin-logout');
    const registrosBody = document.getElementById('registros-body');

    const getRegistros = () => {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        return stored ? JSON.parse(stored) : [];
      } catch (error) {
        console.error('No se pudieron leer los registros', error);
        return [];
      }
    };

    const guardarRegistros = (registros) => {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(registros));
      } catch (error) {
        console.error('No se pudieron guardar los registros', error);
      }
    };

    const limpiarTabla = () => {
      if (!registrosBody) return;
      registrosBody.querySelectorAll('tr').forEach((row) => {
        if (!row.classList.contains('admin-empty')) {
          row.remove();
        }
      });
    };

    const actualizarTabla = () => {
      if (!registrosBody) return;
      const registros = getRegistros();
      limpiarTabla();

      const emptyRow = registrosBody.querySelector('.admin-empty');
      if (!registros.length) {
        if (emptyRow) {
          emptyRow.hidden = false;
        }
        return;
      }

      if (emptyRow) {
        emptyRow.hidden = true;
      }

      registros.forEach((registro) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td data-label="Nombre">${registro.nombre}</td>
          <td data-label="Correo">${registro.email}</td>
          <td data-label="Tel√©fono">${registro.telefono}</td>
          <td data-label="Direcci√≥n">${registro.direccion}</td>
          <td data-label="Servicio">${registro.servicio}</td>
          <td data-label="Comentarios">${registro.comentarios || '‚Äî'}</td>
          <td data-label="Fecha">${registro.fecha}</td>
        `;
        registrosBody.appendChild(row);
      });
    };

    const exportarExcel = () => {
      const registros = getRegistros();
      if (!registros.length) {
        if (adminFeedback) {
          adminFeedback.textContent = 'No hay registros para exportar.';
        }
        return;
      }

      const encabezados = ['Nombre', 'Correo', 'Tel√©fono', 'Direcci√≥n', 'Servicio', 'Comentarios', 'Fecha'];
      const filas = registros.map((registro) => [
        registro.nombre,
        registro.email,
        registro.telefono,
        registro.direccion,
        registro.servicio,
        registro.comentarios?.replace(/\r?\n/g, ' '),
        registro.fecha
      ]);

      const contenido = [encabezados, ...filas]
        .map((fila) => fila.map((celda) => `"${(celda || '').replace(/"/g, '""')}"`).join(','))
        .join('\n');

      const blob = new Blob([contenido], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const enlace = document.createElement('a');
      enlace.href = url;
      enlace.download = `solicitudes-tu-basura-mi-tesoro-${new Date().toISOString().slice(0, 10)}.xlsx`;
      enlace.click();
      URL.revokeObjectURL(url);
      if (adminFeedback) {
        adminFeedback.textContent = 'Descarga generada correctamente.';
      }
    };

    if (yearElement) {
      yearElement.textContent = new Date().getFullYear();
    }

    if (form) {
      form.addEventListener('submit', (event) => {
        event.preventDefault();
        const formData = new FormData(form);
        const registro = {
          nombre: (formData.get('nombre') || '').toString().trim(),
          email: (formData.get('email') || '').toString().trim(),
          telefono: (formData.get('telefono') || '').toString().trim(),
          direccion: (formData.get('direccion') || '').toString().trim(),
          servicio: formData.get('servicio'),
          comentarios: (formData.get('comentarios') || '').toString().trim(),
          fecha: new Intl.DateTimeFormat('es-UY', {
            dateStyle: 'full',
            timeStyle: 'short'
          }).format(new Date())
        };

        if (!registro.servicio) {
          feedback.textContent = 'Seleccion√° el tipo de servicio para continuar.';
          return;
        }

        const registros = getRegistros();
        registros.push(registro);
        guardarRegistros(registros);
        form.reset();
        const select = form.querySelector('#servicio');
        if (select) {
          select.selectedIndex = 0;
        }
        feedback.textContent = '¬°Gracias! Tu solicitud fue registrada correctamente.';
      });
    }

    if (adminToggle && adminPanel) {
      adminToggle.addEventListener('click', () => {
        const isHidden = adminPanel.hasAttribute('hidden');
        if (isHidden) {
          adminPanel.hidden = false;
          adminToggle.setAttribute('aria-expanded', 'true');
          if (adminFeedback) {
            adminFeedback.textContent = '';
          }
          if (adminPassword) {
            adminPassword.focus();
          }
        } else {
          adminPanel.hidden = true;
          adminToggle.setAttribute('aria-expanded', 'false');
          if (adminContent) {
            adminContent.hidden = true;
          }
          if (adminLogin) {
            adminLogin.hidden = false;
            adminLogin.reset();
          }
          if (adminFeedback) {
            adminFeedback.textContent = '';
          }
        }
      });
    }

    if (adminLogin) {
      adminLogin.addEventListener('submit', (event) => {
        event.preventDefault();
        const password = adminPassword ? adminPassword.value.trim() : '';
        if (password === ADMIN_PASSWORD) {
          adminLogin.hidden = true;
          if (adminContent) {
            adminContent.hidden = false;
          }
          if (adminFeedback) {
            adminFeedback.textContent = 'Acceso concedido. Ahora pod√©s revisar y descargar los registros.';
          }
          actualizarTabla();
        } else {
          if (adminFeedback) {
            adminFeedback.textContent = 'Contrase√±a incorrecta. Intent√° nuevamente.';
          }
          if (adminPassword) {
            adminPassword.focus();
          }
        }
      });
    }

    if (adminLogout) {
      adminLogout.addEventListener('click', () => {
        if (adminContent) {
          adminContent.hidden = true;
        }
        if (adminLogin) {
          adminLogin.hidden = false;
          adminLogin.reset();
        }
        if (adminFeedback) {
          adminFeedback.textContent = 'Sesi√≥n cerrada.';
        }
        if (adminPassword) {
          adminPassword.focus();
        }
      });
    }

    if (adminExport) {
      adminExport.addEventListener('click', exportarExcel);
    }
  </script>
</body>
</html>
